name: Release

on:
  workflow_dispatch:
    inputs:
      tag:
        description: Choose a tag
      name:
        description: Release title
      body:
        description: Describe this release
      prerelease:
        type: choice
        description: This is a pre-release
        options: 
        - true
        - false

jobs:
  release-mod:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Create mod zip files
        run: |
          # EU base game
          mkdir 0100F8F0000A2000
          rsync -R romfs/Sound/Resource/Stream/BaseNoise_Plaza.bfstm romfs/Sound/Resource/Stream/Plaza00_c_VS.bfstm 0100F8F0000A2000
          # JP base game
          mkdir 01003C700009C000
          rsync -R romfs/Sound/Resource/Stream/BaseNoise_Plaza.bfstm romfs/Sound/Resource/Stream/Plaza00_c_VS.bfstm 01003C700009C000
          # US base game
          mkdir 01003BC0000A0000
          rsync -R romfs/Sound/Resource/Stream/BaseNoise_Plaza.bfstm romfs/Sound/Resource/Stream/Plaza00_c_VS.bfstm 01003BC0000A0000
          # EU octo expansion
          mkdir 0100F8F0000A3065
          rsync -a romfs 0100F8F0000A3065 --exclude romfs/Sound/Resource/Stream/BaseNoise_Plaza.bfstm --exclude romfs/Sound/Resource/Stream/Plaza00_c_VS.bfstm
          # JP octo expansion
          mkdir 01003C700009D065
          rsync -a romfs 01003C700009D065 --exclude romfs/Sound/Resource/Stream/BaseNoise_Plaza.bfstm --exclude romfs/Sound/Resource/Stream/Plaza00_c_VS.bfstm
          # US octo expansion
          mkdir 01003BC0000A1065
          rsync -a romfs 01003BC0000A1065 --exclude romfs/Sound/Resource/Stream/BaseNoise_Plaza.bfstm --exclude romfs/Sound/Resource/Stream/Plaza00_c_VS.bfstm
          # Zip EU mod
          zip -r EU.zip 0100F8F0000A2000 0100F8F0000A3065
          # Zip JP mod
          zip -r JP.zip 01003C700009C000 01003C700009D065
          # Zip US mod
          zip -r US.zip 01003BC0000A0000 01003BC0000A1065

      - name: GH Release
        uses: softprops/action-gh-release@v1
        with:
          body: ${{ github.event.inputs.body }}
          prerelease: ${{ github.event.inputs.prerelease }}
          files: |
            EU.zip
            JP.zip
            US.zip
          name: ${{ github.event.inputs.name }}
          tag_name: ${{ github.event.inputs.tag }}
